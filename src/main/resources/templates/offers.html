<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="" />
<meta name="author" content="" />

<title>Offers</title>
<link href="/css/bootstrap.min.css"
          th:href="@{css/bootstrap.min.css}" rel="stylesheet" media="screen"/>
<link href="/css/bootstrap-theme.min.css"
          th:href="@{css/bootstrap-theme.min.css}" rel="stylesheet" media="screen"/>    
<link href="/css/custom.css"
          th:href="@{css/custom.css}" rel="stylesheet" media="screen"/>          

</head>

<body background="/images/bgimage.jpg">
		<div id ="main" class="container">
			 <p class="padding-top"></p>
			<h3>Shopping Results/Offer/Shopping Cart</h3>
			<hr></hr>
			<p class="padding-bottom"></p>
				<div class="row">
       			 <div class="col-sm-3">
       			 	<div class="row">
       			 		<div class="col-sm-12">
							<div class ="well well-xs">
							<label for="stop">Stops</label>
							</div>
							<ul class="slide">
								<li th:each="stop : ${T(com.aa.ndchtml5.common.Stop).stopsList}">
									<input type="checkbox" th:id ="${stop.getCode()}"  onclick = "getDetailsOnFilterSelection()"
									th:value="${stop.getCode()}" /> 
									<label th:for="${stop.getCode()}" th:text="${stop.getValue()}"></label>
								</li>
							</ul>
						</div>
						<div class="col-sm-12">
							<div class ="well well-xs">
							<label for="airline">Airlines</label>
							</div>
							<ul class="slide">
								<li th:each="airline : ${T(com.aa.ndchtml5.common.Airline).airlineList}">
									<input type="checkbox" th:id ="${airline.getCode()}"  onclick = "getDetailsOnFilterSelection()"
									th:value="${airline.getCode()}" /> 
									<label th:for="${airline.getCode()}" th:text="${airline.getValue()}"></label>
								</li>
							</ul>
						</div>
						<div class="col-sm-12">
							<div class ="well well-xs">
							<label for="feature">Features</label>
							</div>
							<ul class="slide">
								<li th:each="feature : ${T(com.aa.ndchtml5.common.Feature).featuresList}">
									<input  type="checkbox" th:id ="${feature.getCode()}"  onclick = "getDetailsOnFilterSelection()"
									th:value="${feature.getCode()}" /> 
									<label th:for="${feature.getCode()}">
									<img th:title="${feature.getCode()}" th:src="${feature.getValue()}" th:alt="${feature.getCode()}"></img>
									</label>
								</li>
							</ul>
						</div>
					</div>
       			 </div>
       			  <div id ="filtered-result" th:fragment="resultsList" th:object ="${offerList}" class="col-sm-offset-1 col-sm-5">
       			  <table class="offertable">
					<th:block  th:each="offer : ${offerList.offerDetailsList}">
					<tr >
		        		<td id="filtered-offer-td">
		        		<div class="well">
		        		<div class="row">
		        		<div class="thumbnail well-xs">
		        			<div class = "row">
		        			<label class="col-xs-offset-2 col-xs-2">Offer </label>
		        			<label class="col-xs-offset-1 col-xs-7" th:text="${offer.offerId}"></label>
		        			<label class=" col-xs-offset-2 col-xs-12 red-label" th:text="${offer.offerExpiryDate}"> </label>
		        			</div>
		        		</div>
		        		<label class="col-xs-12 underline" th:text="${offer.flightDetails}"> </label>
		        		<div class = "padding-lines"></div>
		        		<label class="col-xs-3">Fare:</label>
		        		<label class="col-xs-9" th:text="${offer.fare}"> </label>
						<div class = "padding-lines"></div>
						<div class="col-xs=12">
						<label>Included</label>
						<ul><li th:each="inclFeature : ${offer.includeFeatures}" th:text="${inclFeature}"></li></ul>
						</div>
						<div class = "padding-lines"></div>
						<div class="col-xs=12">
						<label>For Purchase</label>
						<ul><li th:each="purFeature : ${offer.purchaseFeautues}" th:text="${purFeature}"></li></ul>
						</div>
						<button type="button" id="add-to-cart"
										class="btn btn-warning btn-lg col-xs-12" 
										th:onclick="'javascript:addToCart(\'' + ${offer.offerId} + '\');'">Add to Cart
										<span class="glyphicon-shopping-cart glyphicon"></span></button> 
						</div>				
						</div>	
		        		</td>
    				</tr>
					</th:block>
				</table>
       			</div>
       			<div class="col-sm-3">
       				<div class="row" data-spy="affix" data-offset-top="60" data-offset-bottom="200">
       					<div class="col-xs-12">
       						<img src="/images/shopping_cart.png" alt="shoppingcart"/>
       					</div>
       					<div class="col-xs-4">
       						<button type="reset" id="offer-select-cancel"
										class="btn btn-default btn-lg">Cancel</button>
       					</div>
       					<div class="col-xs-4">
       					<button type="submit" id="offer-select-submit"
										class="btn btn-primary btn-lg">Submit</button>
       					</div>
       				</div>
       			</div>
       		</div>
		</div>		
	
  <script src="/js/jquery.1.10.2.min.js"
            th:src="@{/js/jquery.1.10.2.min.js}"></script>
     <script src="/js/bootstrap.min.js"
            th:src="@{/js/bootstrap.min.js}"></script>  
	<script>
	
	function getDetailsOnFilterSelection() {
		var filters = {}
		filters["selectedFeatures"] =  $("input[type='checkbox']:checked").map(function(){
		    return this.value;
		}).get()
        $.ajax({
			type : "POST",
			contentType : "application/json",
			url : "/getDetailsOnFilterSelection",
			data : JSON.stringify(filters),
			dataType : 'html',
			timeout : 100000,
			success : function(data) {
				console.log("SUCCESS: ", data);
				display(data);
			},
			error : function(e) {
				console.log("ERROR: ",e);
			},
			done : function(e) {
				console.log("DONE");
			}
		});
	}
	function display(data) {
		$("#filtered-result").html(data);
		$("#filtered-offer-td").css({"height":"340"});
	}
	
     function addToCart(offerId) {
        $.ajax({
			type : "POST",
			contentType : "application/json",
			url : "/addToCart",
			data : JSON.stringify(offerId),
			dataType : 'json',
			timeout : 100000,
			success : function(data) {
				console.log("SUCCESS: ", data);
				activateButton();
			},
			error : function(e) {
				console.log("ERROR: ",e);
			},
			done : function(e) {
				console.log("DONE");
			}
		});
	}  
    function activateButton() {
    	$(this).toggleClass("btn-success");
    }
 
</script>
</body>
</html>
